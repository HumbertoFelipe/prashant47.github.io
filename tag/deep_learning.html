<!DOCTYPE html>
<html lang="en">
<head prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#">
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width">
  <title>Heuristic Intelligence - deep_learning</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.4.1/css/bulma.min.css">
    <link rel="stylesheet" href="/theme/css/main.365169ea.css">
    <link rel="stylesheet" href="/theme/webassets-external/5f88595a9ad2c678b16c0d171e6e0a71_print.css" media="print">
</head>

<body id="index" class="home">
<header class="hero is-primary">
  <div class="hero-head">
    <div class="container">
      <nav class="nav">
        <div class="nav-left">
          <a class="nav-item is-brand title is-3"
             href="/">Heuristic Intelligence</a>
        </div>
      </nav>
    </div>
  </div>
</header>

<nav class="nav has-shadow is-hidden-print">
  <div class="container">
    <div class="nav-center"></div>
    <span id="navToggle" class="nav-toggle">
      <span></span>
      <span></span>
      <span></span>
    </span>
    <div id="navMenu" class="nav-right nav-menu">
          <a class="nav-item is-tab "
             href="/category/graphlab.html">GraphLab</a>
          <a class="nav-item is-tab "
             href="/category/machine-learning.html">Machine Learning</a>
          <a class="nav-item is-tab "
             href="/category/misc.html">Misc</a>
          <a class="nav-item is-tab "
             href="/category/statistics.html">Statistics</a>
    </div>
  </div>
</nav>

<div class="container">
  <div class="section columns">
    <div class="column is-three-quarters-desktop is-two-thirds-tablet">
      <aside id="featured" class="body">
        <article>
          <h1 class="title">
            <a href="/2016/Mar/13/deep_learning_image_classification.html">Deep Learning Image Classification</a>
          </h1>
<footer class="post-info">
  <abbr class="published" title="2016-03-13T12:00:00+05:30">
    Published <span class="is-info">Sun 13 March 2016</span>
    in <a href="/category/graphlab.html">GraphLab</a>
  </abbr>

    <p class="author">
      <em>by           Prashant Gonarkar
</em>
      <span class="tag is-small"><a href="/tag/python.html">python</a></span>
      <span class="tag is-small"><a href="/tag/deep_learning.html">deep_learning</a></span>
    </p>
  
</footer>          <div class="section">
           <!-- <p>In this article, we focused on using deep learning to create non-linear features to improve the performance of machine learning. We will also see how transfer learning techniques can be applied to use deep features learned with one dataset to get great performance on a different dataset. In this Ipython notebook, we are going to build new image retrieval models and explore their results on different parts of our image dataset</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">graphlab</span>
</pre></div>


<h1>Load a commom image analysis dataset</h1>
<div class="highlight"><pre><span></span><span class="c1"># CSV format datasets https://d396qusza40orc.cloudfront.net/phoenixassets/image_train_data.csv</span>
<span class="c1"># https://d396qusza40orc.cloudfront.net/phoenixassets/image_test_data.csv</span>
<span class="n">image_train</span> <span class="o">=</span> <span class="n">graphlab</span><span class="o">.</span><span class="n">SFrame</span><span class="p">(</span><span class="s1">&#39;coursera-notebooks/course-1/image_train_data&#39;</span><span class="p">)</span>
<span class="n">image_test</span> <span class="o">=</span> <span class="n">graphlab</span><span class="o">.</span><span class="n">SFrame</span><span class="p">(</span><span class="s1">&#39;coursera-notebooks/course-1/image_test_data&#39;</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span>[INFO] This non-commercial license of GraphLab Create is assigned to prashantgonarkar@gmail.com and will expire on February 13, 2017. For commercial licensing options, visit https://dato.com/buy/.

[INFO] Start server at: ipc:///tmp/graphlab_server-1420 - Server binary: /usr/local/lib/python2.7/dist-packages/graphlab/unity_server - Server log: /tmp/graphlab_server_1457450628.log
[INFO] GraphLab Server Version: 1.8
</pre></div>


<h1>Exploring the image data</h1>
<div class="highlight"><pre><span></span><span class="n">graphlab</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">set_target</span><span class="p">(</span><span class="s1">&#39;ipynb&#39;</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">image_train</span><span class="p">[</span><span class="s1">&#39;image&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">image_train</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>


<div style="max-height:1000px;max-width:1500px;overflow:auto;"><table frame="box" rules="cols">
    <tr>
        <th style="padding-left: 1em; padding-right: 1em; text-align: center">id</th>
        <th style="padding-left: 1em; padding-right: 1em; text-align: center">image</th>
        <th style="padding-left: 1em; padding-right: 1em; text-align: center">label</th>
        <th style="padding-left: 1em; padding-right: 1em; text-align: center">deep_features</th>
        <th style="padding-left: 1em; padding-right: 1em; text-align: center">image_array</th>
    </tr>
    <tr>
        <td style="padding-left: 1em; padding-right: 1em; text-align: center; vertical-align: top">24</td>
        <td style="padding-left: 1em; padding-right: 1em; text-align: center; vertical-align: top">Height: 32 Width: 32</td>
        <td style="padding-left: 1em; padding-right: 1em; text-align: center; vertical-align: top">bird</td>
        <td style="padding-left: 1em; padding-right: 1em; text-align: center; vertical-align: top">[0.242871761322,<br>1.09545373917, 0.0, ...</td>
        <td style="padding-left: 1em; padding-right: 1em; text-align: center; vertical-align: top">[73.0, 77.0, 58.0, 71.0,<br>68.0, 50.0, 77.0, 69.0, ...</td>
    </tr>
    <tr>
        <td style="padding-left: 1em; padding-right: 1em; text-align: center; vertical-align: top">33</td>
        <td style="padding-left: 1em; padding-right: 1em; text-align: center; vertical-align: top">Height: 32 Width: 32</td>
        <td style="padding-left: 1em; padding-right: 1em; text-align: center; vertical-align: top">cat</td>
        <td style="padding-left: 1em; padding-right: 1em; text-align: center; vertical-align: top">[0.525087952614, 0.0,<br>0.0, 0.0, 0.0, 0.0, ...</td>
        <td style="padding-left: 1em; padding-right: 1em; text-align: center; vertical-align: top">[7.0, 5.0, 8.0, 7.0, 5.0,<br>8.0, 5.0, 4.0, 6.0, 7.0, ...</td>
    </tr>
    <tr>
        <td style="padding-left: 1em; padding-right: 1em; text-align: center; vertical-align: top">36</td>
        <td style="padding-left: 1em; padding-right: 1em; text-align: center; vertical-align: top">Height: 32 Width: 32</td>
        <td style="padding-left: 1em; padding-right: 1em; text-align: center; vertical-align: top">cat</td>
        <td style="padding-left: 1em; padding-right: 1em; text-align: center; vertical-align: top">[0.566015958786, 0.0,<br>0.0, 0.0, 0.0, 0.0, ...</td>
        <td style="padding-left: 1em; padding-right: 1em; text-align: center; vertical-align: top">[169.0, 122.0, 65.0,<br>131.0, 108.0, 75.0, ...</td>
    </tr>
    <tr>
        <td style="padding-left: 1em; padding-right: 1em; text-align: center; vertical-align: top">70</td>
        <td style="padding-left: 1em; padding-right: 1em; text-align: center; vertical-align: top">Height: 32 Width: 32</td>
        <td style="padding-left: 1em; padding-right: 1em; text-align: center; vertical-align: top">dog</td>
        <td style="padding-left: 1em; padding-right: 1em; text-align: center; vertical-align: top">[1.12979578972, 0.0, 0.0,<br>0.778194487095, 0.0, ...</td>
        <td style="padding-left: 1em; padding-right: 1em; text-align: center; vertical-align: top">[154.0, 179.0, 152.0,<br>159.0, 183.0, 157.0, ...</td>
    </tr>
    <tr>
        <td style="padding-left: 1em; padding-right: 1em; text-align: center; vertical-align: top">90</td>
        <td style="padding-left: 1em; padding-right: 1em; text-align: center; vertical-align: top">Height: 32 Width: 32</td>
        <td style="padding-left: 1em; padding-right: 1em; text-align: center; vertical-align: top">bird</td>
        <td style="padding-left: 1em; padding-right: 1em; text-align: center; vertical-align: top">[1.71786928177, 0.0, 0.0,<br>0.0, 0.0, 0.0, ...</td>
        <td style="padding-left: 1em; padding-right: 1em; text-align: center; vertical-align: top">[216.0, 195.0, 180.0,<br>201.0, 178.0, 160.0, ...</td>
    </tr>
    <tr>
        <td style="padding-left: 1em; padding-right: 1em; text-align: center; vertical-align: top">97</td>
        <td style="padding-left: 1em; padding-right: 1em; text-align: center; vertical-align: top">Height: 32 Width: 32</td>
        <td style="padding-left: 1em; padding-right: 1em; text-align: center; vertical-align: top">automobile</td>
        <td style="padding-left: 1em; padding-right: 1em; text-align: center; vertical-align: top">[1.57818555832, 0.0, 0.0,<br>0.0, 0.0, 0.0, ...</td>
        <td style="padding-left: 1em; padding-right: 1em; text-align: center; vertical-align: top">[33.0, 44.0, 27.0, 29.0,<br>44.0, 31.0, 32.0, 45.0, ...</td>
    </tr>
    <tr>
        <td style="padding-left: 1em; padding-right: 1em; text-align: center; vertical-align: top">107</td>
        <td style="padding-left: 1em; padding-right: 1em; text-align: center; vertical-align: top">Height: 32 Width: 32</td>
        <td style="padding-left: 1em; padding-right: 1em; text-align: center; vertical-align: top">dog</td>
        <td style="padding-left: 1em; padding-right: 1em; text-align: center; vertical-align: top">[0.0, 0.0,<br>0.220677852631, 0.0,  ...</td>
        <td style="padding-left: 1em; padding-right: 1em; text-align: center; vertical-align: top">[97.0, 51.0, 31.0, 104.0,<br>58.0, 38.0, 107.0, 61.0, ...</td>
    </tr>
    <tr>
        <td style="padding-left: 1em; padding-right: 1em; text-align: center; vertical-align: top">121</td>
        <td style="padding-left: 1em; padding-right: 1em; text-align: center; vertical-align: top">Height: 32 Width: 32</td>
        <td style="padding-left: 1em; padding-right: 1em; text-align: center; vertical-align: top">bird</td>
        <td style="padding-left: 1em; padding-right: 1em; text-align: center; vertical-align: top">[0.0, 0.23753464222, 0.0,<br>0.0, 0.0, 0.0, ...</td>
        <td style="padding-left: 1em; padding-right: 1em; text-align: center; vertical-align: top">[93.0, 96.0, 88.0, 102.0,<br>106.0, 97.0, 117.0, ...</td>
    </tr>
    <tr>
        <td style="padding-left: 1em; padding-right: 1em; text-align: center; vertical-align: top">136</td>
        <td style="padding-left: 1em; padding-right: 1em; text-align: center; vertical-align: top">Height: 32 Width: 32</td>
        <td style="padding-left: 1em; padding-right: 1em; text-align: center; vertical-align: top">automobile</td>
        <td style="padding-left: 1em; padding-right: 1em; text-align: center; vertical-align: top">[0.0, 0.0, 0.0, 0.0, 0.0,<br>0.0, 7.5737862587, 0.0, ...</td>
        <td style="padding-left: 1em; padding-right: 1em; text-align: center; vertical-align: top">[35.0, 59.0, 53.0, 36.0,<br>56.0, 56.0, 42.0, 62.0, ...</td>
    </tr>
    <tr>
        <td style="padding-left: 1em; padding-right: 1em; text-align: center; vertical-align: top">138</td>
        <td style="padding-left: 1em; padding-right: 1em; text-align: center; vertical-align: top">Height: 32 Width: 32</td>
        <td style="padding-left: 1em; padding-right: 1em; text-align: center; vertical-align: top">bird</td>
        <td style="padding-left: 1em; padding-right: 1em; text-align: center; vertical-align: top">[0.658935725689, 0.0,<br>0.0, 0.0, 0.0, 0.0, ...</td>
        <td style="padding-left: 1em; padding-right: 1em; text-align: center; vertical-align: top">[205.0, 193.0, 195.0,<br>200.0, 187.0, 193.0, ...</td>
    </tr>
</table>
[10 rows x 5 columns]<br/>
</div>

<p># Train a classifier on the raw image pixels</p>
<div class="highlight"><pre><span></span><span class="n">raw_pixel_model</span> <span class="o">=</span> <span class="n">graphlab</span><span class="o">.</span><span class="n">logistic_classifier</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">image_train</span><span class="p">,</span><span class="n">target</span><span class="o">=</span><span class="s1">&#39;label&#39;</span><span class="p">,</span><span class="n">features</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;image_array&#39;</span><span class="p">])</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">PROGRESS</span><span class="o">:</span> <span class="n">Creating</span> <span class="n">a</span> <span class="n">validation</span> <span class="kd">set</span> <span class="n">from</span> <span class="mi">5</span> <span class="n">percent</span> <span class="n">of</span> <span class="n">training</span> <span class="n">data</span><span class="o">.</span> <span class="n">This</span> <span class="n">may</span> <span class="n">take</span> <span class="n">a</span> <span class="k">while</span><span class="o">.</span>
          <span class="n">You</span> <span class="n">can</span> <span class="kd">set</span> <span class="err">``</span><span class="n">validation_set</span><span class="o">=</span><span class="n">None</span><span class="err">``</span> <span class="n">to</span> <span class="n">disable</span> <span class="n">validation</span> <span class="n">tracking</span><span class="o">.</span>

<span class="n">PROGRESS</span><span class="o">:</span> <span class="n">Logistic</span> <span class="n">regression</span><span class="o">:</span>
<span class="n">PROGRESS</span><span class="o">:</span> <span class="o">--------------------------------------------------------</span>
<span class="n">PROGRESS</span><span class="o">:</span> <span class="n">Number</span> <span class="n">of</span> <span class="n">examples</span>          <span class="o">:</span> <span class="mi">1903</span>
<span class="n">PROGRESS</span><span class="o">:</span> <span class="n">Number</span> <span class="n">of</span> <span class="n">classes</span>           <span class="o">:</span> <span class="mi">4</span>
<span class="n">PROGRESS</span><span class="o">:</span> <span class="n">Number</span> <span class="n">of</span> <span class="n">feature</span> <span class="n">columns</span>   <span class="o">:</span> <span class="mi">1</span>
<span class="n">PROGRESS</span><span class="o">:</span> <span class="n">Number</span> <span class="n">of</span> <span class="n">unpacked</span> <span class="n">features</span> <span class="o">:</span> <span class="mi">3072</span>
<span class="n">PROGRESS</span><span class="o">:</span> <span class="n">Number</span> <span class="n">of</span> <span class="n">coefficients</span>    <span class="o">:</span> <span class="mi">9219</span>
<span class="n">PROGRESS</span><span class="o">:</span> <span class="n">Starting</span> <span class="n">L</span><span class="o">-</span><span class="n">BFGS</span>
<span class="n">PROGRESS</span><span class="o">:</span> <span class="o">--------------------------------------------------------</span>
<span class="n">PROGRESS</span><span class="o">:</span> <span class="o">+-----------+----------+-----------+--------------+-------------------+---------------------+</span>
<span class="n">PROGRESS</span><span class="o">:</span> <span class="o">|</span> <span class="n">Iteration</span> <span class="o">|</span> <span class="n">Passes</span>   <span class="o">|</span> <span class="n">Step</span> <span class="n">size</span> <span class="o">|</span> <span class="n">Elapsed</span> <span class="n">Time</span> <span class="o">|</span> <span class="n">Training</span><span class="o">-</span><span class="n">accuracy</span> <span class="o">|</span> <span class="n">Validation</span><span class="o">-</span><span class="n">accuracy</span> <span class="o">|</span>
<span class="n">PROGRESS</span><span class="o">:</span> <span class="o">+-----------+----------+-----------+--------------+-------------------+---------------------+</span>
<span class="n">PROGRESS</span><span class="o">:</span> <span class="o">|</span> <span class="mi">1</span>         <span class="o">|</span> <span class="mi">6</span>        <span class="o">|</span> <span class="mf">0.000021</span>  <span class="o">|</span> <span class="mf">4.622984</span>     <span class="o">|</span> <span class="mf">0.379401</span>          <span class="o">|</span> <span class="mf">0.382353</span>            <span class="o">|</span>
<span class="n">PROGRESS</span><span class="o">:</span> <span class="o">|</span> <span class="mi">2</span>         <span class="o">|</span> <span class="mi">8</span>        <span class="o">|</span> <span class="mf">1.000000</span>  <span class="o">|</span> <span class="mf">6.046222</span>     <span class="o">|</span> <span class="mf">0.388334</span>          <span class="o">|</span> <span class="mf">0.411765</span>            <span class="o">|</span>
<span class="n">PROGRESS</span><span class="o">:</span> <span class="o">|</span> <span class="mi">3</span>         <span class="o">|</span> <span class="mi">9</span>        <span class="o">|</span> <span class="mf">1.000000</span>  <span class="o">|</span> <span class="mf">6.869242</span>     <span class="o">|</span> <span class="mf">0.437730</span>          <span class="o">|</span> <span class="mf">0.450980</span>            <span class="o">|</span>
<span class="n">PROGRESS</span><span class="o">:</span> <span class="o">|</span> <span class="mi">4</span>         <span class="o">|</span> <span class="mi">10</span>       <span class="o">|</span> <span class="mf">1.000000</span>  <span class="o">|</span> <span class="mf">7.699640</span>     <span class="o">|</span> <span class="mf">0.439832</span>          <span class="o">|</span> <span class="mf">0.480392</span>            <span class="o">|</span>
<span class="n">PROGRESS</span><span class="o">:</span> <span class="o">|</span> <span class="mi">5</span>         <span class="o">|</span> <span class="mi">11</span>       <span class="o">|</span> <span class="mf">1.000000</span>  <span class="o">|</span> <span class="mf">8.534293</span>     <span class="o">|</span> <span class="mf">0.452444</span>          <span class="o">|</span> <span class="mf">0.480392</span>            <span class="o">|</span>
<span class="n">PROGRESS</span><span class="o">:</span> <span class="o">|</span> <span class="mi">6</span>         <span class="o">|</span> <span class="mi">12</span>       <span class="o">|</span> <span class="mf">1.000000</span>  <span class="o">|</span> <span class="mf">9.366371</span>     <span class="o">|</span> <span class="mf">0.478192</span>          <span class="o">|</span> <span class="mf">0.500000</span>            <span class="o">|</span>
<span class="n">PROGRESS</span><span class="o">:</span> <span class="o">|</span> <span class="mi">10</span>        <span class="o">|</span> <span class="mi">16</span>       <span class="o">|</span> <span class="mf">1.000000</span>  <span class="o">|</span> <span class="mf">12.661399</span>    <span class="o">|</span> <span class="mf">0.517078</span>          <span class="o">|</span> <span class="mf">0.490196</span>            <span class="o">|</span>
<span class="n">PROGRESS</span><span class="o">:</span> <span class="o">+-----------+----------+-----------+--------------+-------------------+---------------------+</span>
<span class="n">PROGRESS</span><span class="o">:</span> <span class="n">TERMINATED</span><span class="o">:</span> <span class="n">Iteration</span> <span class="n">limit</span> <span class="n">reached</span><span class="o">.</span>
<span class="n">PROGRESS</span><span class="o">:</span> <span class="n">This</span> <span class="n">model</span> <span class="n">may</span> <span class="n">not</span> <span class="n">be</span> <span class="n">optimal</span><span class="o">.</span> <span class="n">To</span> <span class="n">improve</span> <span class="n">it</span><span class="o">,</span> <span class="n">consider</span> <span class="n">increasing</span> <span class="err">`</span><span class="n">max_iterations</span><span class="err">`</span><span class="o">.</span>
</pre></div>


<h1>Making prediction with simple model based on raw pixels</h1>
<div class="highlight"><pre><span></span><span class="n">image_test</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">][</span><span class="s1">&#39;image&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">image_test</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">][</span><span class="s1">&#39;label&#39;</span><span class="p">]</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">dtype</span><span class="o">:</span> <span class="n">str</span>
<span class="n">Rows</span><span class="o">:</span> <span class="mi">3</span>
<span class="o">[</span><span class="s1">&#39;cat&#39;</span><span class="o">,</span> <span class="s1">&#39;automobile&#39;</span><span class="o">,</span> <span class="s1">&#39;cat&#39;</span><span class="o">]</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">raw_pixel_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">image_test</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">])</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">dtype</span><span class="o">:</span> <span class="n">str</span>
<span class="n">Rows</span><span class="o">:</span> <span class="mi">3</span>
<span class="o">[</span><span class="s1">&#39;bird&#39;</span><span class="o">,</span> <span class="s1">&#39;cat&#39;</span><span class="o">,</span> <span class="s1">&#39;bird&#39;</span><span class="o">]</span>
</pre></div>


<h1>Evaluate raw pixel model on test data</h1>
<div class="highlight"><pre><span></span><span class="n">raw_pixel_model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">image_test</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span>{&#39;accuracy&#39;: 0.4775, &#39;auc&#39;: 0.7196601666666673, &#39;confusion_matrix&#39;: Columns:
    target_label    str
    predicted_label str
    count   int

 Rows: 16

 Data:
 +--------------+-----------------+-------+
 | target_label | predicted_label | count |
 +--------------+-----------------+-------+
 |     bird     |       dog       |  179  |
 |     dog      |       cat       |  236  |
 |     cat      |       cat       |  338  |
 |     bird     |    automobile   |  132  |
 |  automobile  |    automobile   |  625  |
 |     dog      |    automobile   |  102  |
 |     dog      |       dog       |  417  |
 |     cat      |       dog       |  295  |
 |     bird     |       cat       |  159  |
 |  automobile  |       bird      |  110  |
 +--------------+-----------------+-------+
 [16 rows x 3 columns]
 Note: Only the head of the SFrame is printed.
 You can use print_rows(num_rows=m, num_columns=n) to print more rows and columns., &#39;f1_score&#39;: 0.4750893898174211, &#39;log_loss&#39;: 1.20979288252905, &#39;precision&#39;: 0.47388806650241955, &#39;recall&#39;: 0.47750000000000004, &#39;roc_curve&#39;: Columns:
    threshold   float
    fpr float
    tpr float
    p   int
    n   int
    class   int

 Rows: 400004

 Data:
 +-----------+-----+-----+------+------+-------+
 | threshold | fpr | tpr |  p   |  n   | class |
 +-----------+-----+-----+------+------+-------+
 |    0.0    | 1.0 | 1.0 | 1000 | 3000 |   0   |
 |   1e-05   | 1.0 | 1.0 | 1000 | 3000 |   0   |
 |   2e-05   | 1.0 | 1.0 | 1000 | 3000 |   0   |
 |   3e-05   | 1.0 | 1.0 | 1000 | 3000 |   0   |
 |   4e-05   | 1.0 | 1.0 | 1000 | 3000 |   0   |
 |   5e-05   | 1.0 | 1.0 | 1000 | 3000 |   0   |
 |   6e-05   | 1.0 | 1.0 | 1000 | 3000 |   0   |
 |   7e-05   | 1.0 | 1.0 | 1000 | 3000 |   0   |
 |   8e-05   | 1.0 | 1.0 | 1000 | 3000 |   0   |
 |   9e-05   | 1.0 | 1.0 | 1000 | 3000 |   0   |
 +-----------+-----+-----+------+------+-------+
 [400004 rows x 6 columns]
 Note: Only the head of the SFrame is printed.
 You can use print_rows(num_rows=m, num_columns=n) to print more rows and columns.}
</pre></div>


<h1>Can we improve the model using the deep features</h1>
<div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">image_train</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span>2005
</pre></div>


<div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">image_test</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span>4000
</pre></div>


<div class="highlight"><pre><span></span><span class="c1"># takes time, already computed and loaded in sframe</span>
<span class="c1"># deep_learning_model = graphlab.load_model(&#39;imagenet_model&#39;)</span>
<span class="c1"># image_train[&#39;deep_features&#39;] = deep_learning_model.extract_features(image_train)</span>
</pre></div>


<h1>Given deep features. lets train a classifier</h1>
<div class="highlight"><pre><span></span><span class="n">deep_features_model</span> <span class="o">=</span> <span class="n">graphlab</span><span class="o">.</span><span class="n">logistic_classifier</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">image_train</span><span class="p">,</span>
                                                         <span class="n">features</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;deep_features&#39;</span><span class="p">],</span>
                                                         <span class="n">target</span><span class="o">=</span><span class="s1">&#39;label&#39;</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">PROGRESS</span><span class="o">:</span> <span class="n">Creating</span> <span class="n">a</span> <span class="n">validation</span> <span class="kd">set</span> <span class="n">from</span> <span class="mi">5</span> <span class="n">percent</span> <span class="n">of</span> <span class="n">training</span> <span class="n">data</span><span class="o">.</span> <span class="n">This</span> <span class="n">may</span> <span class="n">take</span> <span class="n">a</span> <span class="k">while</span><span class="o">.</span>
          <span class="n">You</span> <span class="n">can</span> <span class="kd">set</span> <span class="err">``</span><span class="n">validation_set</span><span class="o">=</span><span class="n">None</span><span class="err">``</span> <span class="n">to</span> <span class="n">disable</span> <span class="n">validation</span> <span class="n">tracking</span><span class="o">.</span>

<span class="n">PROGRESS</span><span class="o">:</span> <span class="n">WARNING</span><span class="o">:</span> <span class="n">Detected</span> <span class="n">extremely</span> <span class="n">low</span> <span class="n">variance</span> <span class="k">for</span> <span class="n">feature</span><span class="o">(</span><span class="n">s</span><span class="o">)</span> <span class="s1">&#39;deep_features&#39;</span> <span class="n">because</span> <span class="n">all</span> <span class="n">entries</span> <span class="n">are</span> <span class="n">nearly</span> <span class="n">the</span> <span class="n">same</span><span class="o">.</span>
<span class="n">Proceeding</span> <span class="k">with</span> <span class="n">model</span> <span class="n">training</span> <span class="n">using</span> <span class="n">all</span> <span class="n">features</span><span class="o">.</span> <span class="n">If</span> <span class="n">the</span> <span class="n">model</span> <span class="n">does</span> <span class="n">not</span> <span class="n">provide</span> <span class="n">results</span> <span class="n">of</span> <span class="n">adequate</span> <span class="n">quality</span><span class="o">,</span> <span class="n">exclude</span> <span class="n">the</span> <span class="n">above</span> <span class="n">mentioned</span> <span class="n">feature</span><span class="o">(</span><span class="n">s</span><span class="o">)</span> <span class="n">from</span> <span class="n">the</span> <span class="n">input</span> <span class="n">dataset</span><span class="o">.</span>
<span class="n">PROGRESS</span><span class="o">:</span> <span class="n">Logistic</span> <span class="n">regression</span><span class="o">:</span>
<span class="n">PROGRESS</span><span class="o">:</span> <span class="o">--------------------------------------------------------</span>
<span class="n">PROGRESS</span><span class="o">:</span> <span class="n">Number</span> <span class="n">of</span> <span class="n">examples</span>          <span class="o">:</span> <span class="mi">1907</span>
<span class="n">PROGRESS</span><span class="o">:</span> <span class="n">Number</span> <span class="n">of</span> <span class="n">classes</span>           <span class="o">:</span> <span class="mi">4</span>
<span class="n">PROGRESS</span><span class="o">:</span> <span class="n">Number</span> <span class="n">of</span> <span class="n">feature</span> <span class="n">columns</span>   <span class="o">:</span> <span class="mi">1</span>
<span class="n">PROGRESS</span><span class="o">:</span> <span class="n">Number</span> <span class="n">of</span> <span class="n">unpacked</span> <span class="n">features</span> <span class="o">:</span> <span class="mi">4096</span>
<span class="n">PROGRESS</span><span class="o">:</span> <span class="n">Number</span> <span class="n">of</span> <span class="n">coefficients</span>    <span class="o">:</span> <span class="mi">12291</span>
<span class="n">PROGRESS</span><span class="o">:</span> <span class="n">Starting</span> <span class="n">L</span><span class="o">-</span><span class="n">BFGS</span>
<span class="n">PROGRESS</span><span class="o">:</span> <span class="o">--------------------------------------------------------</span>
<span class="n">PROGRESS</span><span class="o">:</span> <span class="o">+-----------+----------+-----------+--------------+-------------------+---------------------+</span>
<span class="n">PROGRESS</span><span class="o">:</span> <span class="o">|</span> <span class="n">Iteration</span> <span class="o">|</span> <span class="n">Passes</span>   <span class="o">|</span> <span class="n">Step</span> <span class="n">size</span> <span class="o">|</span> <span class="n">Elapsed</span> <span class="n">Time</span> <span class="o">|</span> <span class="n">Training</span><span class="o">-</span><span class="n">accuracy</span> <span class="o">|</span> <span class="n">Validation</span><span class="o">-</span><span class="n">accuracy</span> <span class="o">|</span>
<span class="n">PROGRESS</span><span class="o">:</span> <span class="o">+-----------+----------+-----------+--------------+-------------------+---------------------+</span>
<span class="n">PROGRESS</span><span class="o">:</span> <span class="o">|</span> <span class="mi">1</span>         <span class="o">|</span> <span class="mi">5</span>        <span class="o">|</span> <span class="mf">0.000131</span>  <span class="o">|</span> <span class="mf">4.232286</span>     <span class="o">|</span> <span class="mf">0.758783</span>          <span class="o">|</span> <span class="mf">0.816327</span>            <span class="o">|</span>
<span class="n">PROGRESS</span><span class="o">:</span> <span class="o">|</span> <span class="mi">2</span>         <span class="o">|</span> <span class="mi">10</span>       <span class="o">|</span> <span class="mf">0.138641</span>  <span class="o">|</span> <span class="mf">8.771076</span>     <span class="o">|</span> <span class="mf">0.767174</span>          <span class="o">|</span> <span class="mf">0.816327</span>            <span class="o">|</span>
<span class="n">PROGRESS</span><span class="o">:</span> <span class="o">|</span> <span class="mi">3</span>         <span class="o">|</span> <span class="mi">11</span>       <span class="o">|</span> <span class="mf">0.138641</span>  <span class="o">|</span> <span class="mf">9.943608</span>     <span class="o">|</span> <span class="mf">0.768222</span>          <span class="o">|</span> <span class="mf">0.816327</span>            <span class="o">|</span>
<span class="n">PROGRESS</span><span class="o">:</span> <span class="o">|</span> <span class="mi">4</span>         <span class="o">|</span> <span class="mi">12</span>       <span class="o">|</span> <span class="mf">0.138641</span>  <span class="o">|</span> <span class="mf">11.128205</span>    <span class="o">|</span> <span class="mf">0.772942</span>          <span class="o">|</span> <span class="mf">0.826531</span>            <span class="o">|</span>
<span class="n">PROGRESS</span><span class="o">:</span> <span class="o">|</span> <span class="mi">5</span>         <span class="o">|</span> <span class="mi">13</span>       <span class="o">|</span> <span class="mf">0.138641</span>  <span class="o">|</span> <span class="mf">12.322463</span>    <span class="o">|</span> <span class="mf">0.785527</span>          <span class="o">|</span> <span class="mf">0.836735</span>            <span class="o">|</span>
<span class="n">PROGRESS</span><span class="o">:</span> <span class="o">|</span> <span class="mi">6</span>         <span class="o">|</span> <span class="mi">14</span>       <span class="o">|</span> <span class="mf">0.138641</span>  <span class="o">|</span> <span class="mf">13.507242</span>    <span class="o">|</span> <span class="mf">0.803356</span>          <span class="o">|</span> <span class="mf">0.836735</span>            <span class="o">|</span>
<span class="n">PROGRESS</span><span class="o">:</span> <span class="o">|</span> <span class="mi">7</span>         <span class="o">|</span> <span class="mi">15</span>       <span class="o">|</span> <span class="mf">0.138641</span>  <span class="o">|</span> <span class="mf">14.696790</span>    <span class="o">|</span> <span class="mf">0.829051</span>          <span class="o">|</span> <span class="mf">0.887755</span>            <span class="o">|</span>
<span class="n">PROGRESS</span><span class="o">:</span> <span class="o">|</span> <span class="mi">8</span>         <span class="o">|</span> <span class="mi">16</span>       <span class="o">|</span> <span class="mf">0.138641</span>  <span class="o">|</span> <span class="mf">15.881160</span>    <span class="o">|</span> <span class="mf">0.835343</span>          <span class="o">|</span> <span class="mf">0.897959</span>            <span class="o">|</span>
<span class="n">PROGRESS</span><span class="o">:</span> <span class="o">|</span> <span class="mi">9</span>         <span class="o">|</span> <span class="mi">17</span>       <span class="o">|</span> <span class="mf">0.138641</span>  <span class="o">|</span> <span class="mf">17.062399</span>    <span class="o">|</span> <span class="mf">0.848453</span>          <span class="o">|</span> <span class="mf">0.897959</span>            <span class="o">|</span>
<span class="n">PROGRESS</span><span class="o">:</span> <span class="o">|</span> <span class="mi">10</span>        <span class="o">|</span> <span class="mi">18</span>       <span class="o">|</span> <span class="mf">0.138641</span>  <span class="o">|</span> <span class="mf">18.250449</span>    <span class="o">|</span> <span class="mf">0.865758</span>          <span class="o">|</span> <span class="mf">0.908163</span>            <span class="o">|</span>
<span class="n">PROGRESS</span><span class="o">:</span> <span class="o">+-----------+----------+-----------+--------------+-------------------+---------------------+</span>
<span class="n">PROGRESS</span><span class="o">:</span> <span class="n">TERMINATED</span><span class="o">:</span> <span class="n">Iteration</span> <span class="n">limit</span> <span class="n">reached</span><span class="o">.</span>
<span class="n">PROGRESS</span><span class="o">:</span> <span class="n">This</span> <span class="n">model</span> <span class="n">may</span> <span class="n">not</span> <span class="n">be</span> <span class="n">optimal</span><span class="o">.</span> <span class="n">To</span> <span class="n">improve</span> <span class="n">it</span><span class="o">,</span> <span class="n">consider</span> <span class="n">increasing</span> <span class="err">`</span><span class="n">max_iterations</span><span class="err">`</span><span class="o">.</span>
</pre></div>


<h1>Apply the deep features model to first few images of test set</h1>
<div class="highlight"><pre><span></span><span class="n">image_test</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">][</span><span class="s1">&#39;image&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">deep_features_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">image_test</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">])</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">dtype</span><span class="o">:</span> <span class="n">str</span>
<span class="n">Rows</span><span class="o">:</span> <span class="mi">3</span>
<span class="o">[</span><span class="s1">&#39;cat&#39;</span><span class="o">,</span> <span class="s1">&#39;automobile&#39;</span><span class="o">,</span> <span class="s1">&#39;cat&#39;</span><span class="o">]</span>
</pre></div>


<h1>Comute the test data accuracy of deep_features model</h1>
<div class="highlight"><pre><span></span><span class="n">deep_features_model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">image_test</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span>{&#39;accuracy&#39;: 0.783, &#39;auc&#39;: 0.9415876666666686, &#39;confusion_matrix&#39;: Columns:
    target_label    str
    predicted_label str
    count   int

 Rows: 16

 Data:
 +--------------+-----------------+-------+
 | target_label | predicted_label | count |
 +--------------+-----------------+-------+
 |     bird     |       cat       |  152  |
 |     dog      |       dog       |  743  |
 |     cat      |       dog       |  229  |
 |     cat      |       bird      |   58  |
 |     bird     |       dog       |   64  |
 |  automobile  |       dog       |   5   |
 |     cat      |    automobile   |   33  |
 |     dog      |       bird      |   35  |
 |  automobile  |    automobile   |  953  |
 |     bird     |    automobile   |   28  |
 +--------------+-----------------+-------+
 [16 rows x 3 columns]
 Note: Only the head of the SFrame is printed.
 You can use print_rows(num_rows=m, num_columns=n) to print more rows and columns., &#39;f1_score&#39;: 0.783820449077231, &#39;log_loss&#39;: 0.5771744600567088, &#39;precision&#39;: 0.7870366726645404, &#39;recall&#39;: 0.7829999999999999, &#39;roc_curve&#39;: Columns:
    threshold   float
    fpr float
    tpr float
    p   int
    n   int
    class   int

 Rows: 400004

 Data:
 +-----------+----------------+-----+------+------+-------+
 | threshold |      fpr       | tpr |  p   |  n   | class |
 +-----------+----------------+-----+------+------+-------+
 |    0.0    |      1.0       | 1.0 | 1000 | 3000 |   0   |
 |   1e-05   | 0.947666666667 | 1.0 | 1000 | 3000 |   0   |
 |   2e-05   |     0.931      | 1.0 | 1000 | 3000 |   0   |
 |   3e-05   |     0.918      | 1.0 | 1000 | 3000 |   0   |
 |   4e-05   |      0.91      | 1.0 | 1000 | 3000 |   0   |
 |   5e-05   | 0.901333333333 | 1.0 | 1000 | 3000 |   0   |
 |   6e-05   | 0.892333333333 | 1.0 | 1000 | 3000 |   0   |
 |   7e-05   | 0.885333333333 | 1.0 | 1000 | 3000 |   0   |
 |   8e-05   |     0.878      | 1.0 | 1000 | 3000 |   0   |
 |   9e-05   | 0.872333333333 | 1.0 | 1000 | 3000 |   0   |
 +-----------+----------------+-----+------+------+-------+
 [400004 rows x 6 columns]
 Note: Only the head of the SFrame is printed.
 You can use print_rows(num_rows=m, num_columns=n) to print more rows and columns.}
</pre></div>


<div class="highlight"><pre><span></span><span class="n">image_train</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sketch_summary</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre><span></span>+------------------+-------+----------+
|       item       | value | is exact |
+------------------+-------+----------+
|      Length      |  2005 |   Yes    |
| # Missing Values |   0   |   Yes    |
| # unique values  |   4   |    No    |
+------------------+-------+----------+

Most frequent items:
+-------+------------+-----+-----+------+
| value | automobile | cat | dog | bird |
+-------+------------+-----+-----+------+
| count |    509     | 509 | 509 | 478  |
+-------+------------+-----+-----+------+
</pre></div>


<p><br><br/>
<em>Credits <a href="https://www.coursera.org/specializations/machine-learning">Machine Learning Foundations: A Case Study Approach</a></em></p>-->
	    <p>Deep Learning Image Classification</p>
            <a href="/2016/Mar/13/deep_learning_image_classification.html">Read more...</a>
          </div>
        </article>
      </aside>
  <div class="is-hidden-print">
    <h2 class="subtitle">Other articles</h2>
    <div class="columns is-multiline">
        <div class="column is-half-tablet is-one-third-desktop">
          <div class="card is-fullwidth is-fullheight">
            <div class="card-content">
              <a href="/2016/Mar/12/image_retrieval_using_deep_features.html">
                <h3 class="title is-5">Image Retrieval using Deep Features</h3>
                <div class="heading subtitle">Sat 12 March 2016</div>
                <div><p>Image Retrieval using Deep Features</p></div>
              </a>
            </div>
          </div>
        </div>
    </div>
<nav class="pagination is-centered">
    <a class="pagination-previous" href="#" disabled>
      Previous
    </a>
    <a class="pagination-next" href="#" disabled>
      Next page
    </a>
  <ul class="pagination-list">
    <li>Page 1 / 1</li>
  </ul>
</nav>
<br>  </div>
    </div>

    <div class="column is-one-quarter-desktop is-one-third-tablet is-hidden-print">
      <aside class="menu">
          <p class="menu-label">Links</p>
          <ul class="menu-list">
                <li><a                        href="/pages/about.html">
                  <span class="icon is-small"><i class="fa fa-book"></i></span>
                  <span class="link-text">About</span>
                </a></li>
                <li><a                        href="/pages/projects.html">
                  <span class="icon is-small"><i class="fa fa-book"></i></span>
                  <span class="link-text">Projects</span>
                </a></li>
          </ul>
<p class="menu-label">Social</p>
<ul class="menu-list">
    <li><a href="https://github.com/prashant47">
      <span class="icon is-small">
          <i class="fa fa-github fa-fw"></i>
      </span>
      <span class="link-text">GitHub</span>
    </a></li>
    <li><a href="http://facebook.com/prashantgonarkar">
      <span class="icon is-small">
          <i class="fa fa-facebook-official fa-fw"></i>
      </span>
      <span class="link-text">Facebook</span>
    </a></li>
    <li><a href="https://twitter.com/pgonarkar">
      <span class="icon is-small">
          <i class="fa fa-twitter fa-fw"></i>
      </span>
      <span class="link-text">Twitter</span>
    </a></li>
</ul>          <p class="menu-label">License</p>
          
<ul class="menu-list">
  <li>
    <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">
      <span class="icon is-small">
        <i class="fa fa-creative-commons fa-fw"></i>
      </span>
      <span>CC BY-SA 4.0</span>
    </a>
  </li>
</ul>

      </aside>
    </div>
  </div>
</div>

<footer class="footer">
  <div class="container has-text-centered">
 <p class="subtitle">The question of whether a computer can think is no more interesting than the question of whether a submarine can swim.â€• Edsger W. Dijkstra</p>    <p><a href="https://github.com/textbook/bulrush">Bulrush</a> theme for
        <a href="https://blog.getpelican.com/">Pelican</a>
      | <span class="icon is-small"><i class="fa fa-html5"></i></span> HTML 5
      | <span class="icon is-small"><i class="fa fa-css3"></i></span> CSS 3
    </p>
  </div>
</footer>

<script type="text/javascript">
  document.getElementById('navToggle').addEventListener('click', function () {
    var nav = document.getElementById('navMenu');
    var className = nav.getAttribute('class');
    if (className == 'nav-right nav-menu') {
      nav.className = 'nav-right nav-menu is-active';
    } else {
      nav.className = 'nav-right nav-menu';
    }
  });
</script>
</body>
</html>